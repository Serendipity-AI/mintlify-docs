export const MarkdownToPDFPlayground = () => {
  const [markdown, setMarkdown] = React.useState('');
  const [invoice, setInvoice] = React.useState(null);
  const [status, setStatus] = React.useState('');

  const stubbedInvoiceAPI = async () => ({
    invoice: 'lnbc1-stubbed-invoice',
    paymentHash: 'abc123',
  });

  const stubbedPaymentPollingAPI = async () => {
    await new Promise(r => setTimeout(r, 5000));
    return { paid: true, pdfUrl: '/stubbed.pdf' };
  };

  const convert = async () => {
    const { invoice, paymentHash } = await stubbedInvoiceAPI();
    setInvoice(invoice);
    setStatus('Waiting for payment...');

    setTimeout(async () => {
      const result = await stubbedPaymentPollingAPI(paymentHash);
      if (result.paid) {
        setStatus('Payment received! Downloading PDF...');
        const link = document.createElement('a');
        link.href = result.pdfUrl;
        link.download = 'converted.pdf';
        link.click();
      }
    }, 3000);
  };

  return (
    <div style={{
      border: '1px solid #ccc',
      borderRadius: '8px',
      padding: '16px',
      marginTop: '1rem'
    }}>
      <h2 style={{ fontSize: '1.5rem', marginBottom: '1rem' }}>Playground</h2>
      <textarea
        style={{
          width: '100%',
          height: '120px',
          fontFamily: 'sans-serif',
          fontSize: '1rem',
          marginBottom: '1rem'
        }}
        value={markdown}
        onChange={(e) => setMarkdown(e.target.value)}
        placeholder="Paste your markdown here..."
      />
      <br />
      <button
        onClick={convert}
        disabled={!!invoice}
        style={{
          backgroundColor: '#4D42F3',
          color: 'white',
          padding: '10px 16px',
          border: 'none',
          borderRadius: '4px',
          cursor: 'pointer'
        }}
      >
        Convert to PDF
      </button>
      {invoice && (
        <div style={{ marginTop: '1rem' }}>
          <p><strong>Scan to pay:</strong></p>
          <div style={{
            backgroundColor: '#f0f0f0',
            padding: '1rem',
            fontFamily: 'monospace',
            wordBreak: 'break-all',
            borderRadius: '4px'
          }}>
            <img
              src={`https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(invoice)}`}
              alt="Lightning QR code"
              style={{ marginTop: '1rem' }}
            />
          </div>
        </div>
      )}
      {status && (
        <p style={{ marginTop: '1rem', color: '#666' }}>{status}</p>
      )}
    </div>
  );
};

<MarkdownToPDFPlayground />